# GitHub Actions workflow to deploy to GitHub Pages (production)
name: Deploy to GitHub Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: "pages-prod"
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: https://dimabors.github.io/denmark-energy-prices/
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Inject build number
        run: |
          sed -i "s/build 0/build ${{ github.run_number }}/g" index.html
          sed -i "s/dk-energy-prices-v6/dk-energy-prices-v6-b${{ github.run_number }}/g" sw.js

      - name: Create artifact directory
        run: |
          mkdir -p _site/.well-known
          cp -r index.html styles.css app.js i18n.js sw.js manifest.json widget.html widget.js icons config README.md _site/
          cp electricity.html electricity-dk1.html electricity-dk2.html diesel.html benzin.html gas.html water.html fjernvarme.html 404.html _site/
          if [ -d ".well-known" ]; then cp -r .well-known/* _site/.well-known/; fi
          rm -f _site/icons/generate-icons.html 2>/dev/null || true

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: _site
          clean: true
          clean-exclude: dev
